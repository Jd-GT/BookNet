{% extends 'shop/base.html' %}

{% block title %}{{ book.title }}{% endblock %}

{% block content %}
<div class="card shadow-sm mb-4">
  <div class="card-body">
    <h2 class="card-title">{{ book.title }}</h2>
    <h6 class="card-subtitle mb-3 text-muted">by {{ book.author }}</h6>

    <!-- Book details in a table -->
    <table class="table table-sm">
      <tbody>
        <tr>
          <th scope="row">Price</th>
          <td>$ {{ book.price }}</td>
        </tr>
        <tr>
          <th scope="row">Stock</th>
          <td>{{ book.stock }}</td>
        </tr>
        <tr>
          <th scope="row">Genre</th>
          <td>{{ book.category }}</td>
        </tr>
      </tbody>
    </table>

    <!-- Average rating -->
    {% if average_rating %}
      <p class="mt-3">
        <strong>Average rating:</strong> 
        ⭐ {{ average_rating|floatformat:1 }} / 5
      </p>
    {% else %}
      <p class="mt-3"><em>No ratings yet.</em></p>
    {% endif %}
  </div>
</div>

<!-- Reviews -->
<div id="reviews" class="mb-4">
  <h3>Reviews</h3>
  <ul class="list-group">
    {% for review in reviews %}
      <li class="list-group-item">
        <strong>{{ review.user.username }}</strong> 
        <span class="badge bg-primary">{{ review.rating }}/5</span><br>
        {{ review.comment }}
      </li>
    {% empty %}
      <li class="list-group-item">No reviews yet.</li>
    {% endfor %}
  </ul>
</div>

<!-- Review form -->
{% if user.is_authenticated %}
  <div class="card p-3 shadow-sm">
    <h4>Leave a Review</h4>
    <form method="post">
      {% csrf_token %}
      <div class="mb-3">
        {{ form.rating.label_tag }}
        {{ form.rating }}
      </div>
      <div class="mb-3">
        {{ form.comment.label_tag }}
        {{ form.comment }}
      </div>
      <button type="submit" class="btn btn-success">Submit Review</button>
    </form>
  </div>
{% else %}
  <p><a href="/accounts/login/" class="btn btn-outline-primary">Login</a> to leave a review.</p>
{% endif %}

<!-- Back button -->
<a href="{% url 'book_list' %}" class="btn btn-secondary mt-3">← Back to Book List</a>

{% endblock %}
